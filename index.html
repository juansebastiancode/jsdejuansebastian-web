<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="jsdejuansebastian: pensamiento, consciencia y proyectos de libertad condensados en un libro corto."
    />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="canonical" href="https://jsdejuansebastian.com/" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="jsdejuansebastian" />
    <meta
      property="og:description"
      content="Solo quiero venderte mi libro. Pensamiento, consciencia y libertad sin rodeos."
    />
    <meta property="og:url" content="https://jsdejuansebastian.com/" />
    <meta property="og:image" content="foto.jpeg" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="jsdejuansebastian" />
    <meta
      name="twitter:description"
      content="Libro breve sobre pensamiento, consciencia y libertad."
    />
    <meta name="twitter:image" content="foto.jpeg" />
    <title>jsdejuansebastian</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Book",
        "name": "Grácil vida",
        "author": {
          "@type": "Person",
          "name": "Juan Sebastian"
        },
        "description": "Libro corto donde resumo mi filosofía sobre pensamiento, consciencia y libertad.",
        "inLanguage": "es",
        "url": "https://www.amazon.es/Grácil-vida-Breves-textos-cuestiones/dp/B0DBGKMRLQ",
        "image": "libro.jpg"
      }
    </script>
  </head>
  <body>
    <nav class="site-nav">
      <div class="site-nav__brand">jsdejuansebastian</div>
      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
        <span class="menu-toggle__line"></span>
        <span class="menu-toggle__line"></span>
        <span class="menu-toggle__line"></span>
      </button>
      <ul class="site-nav__menu">
        <li>
          <a href="https://www.instagram.com/jsdejuansebastian" target="_blank" rel="noreferrer">
            Instagram
          </a>
        </li>
        <li>
          <a href="https://www.tiktok.com/@jsdejuansebastian" target="_blank" rel="noreferrer">
            TikTok
          </a>
        </li>
        <li>
          <a href="https://www.linkedin.com/in/juan-sebasti%C3%A1n-65235b221/" target="_blank" rel="noreferrer">
            LinkedIn
          </a>
        </li>
        <li>
          <a href="https://www.amazon.es/Grácil-vida-Breves-textos-cuestiones/dp/B0DBGKMRLQ" target="_blank" rel="noreferrer">
            Amazon
          </a>
        </li>
      </ul>
    </nav>
    <header class="hero">
      <div class="hero__text">
        <h1 id="filosofia" data-type-title>Solo hablo de <br>dos cosas. Desliza.</h1>
        <div class="hero__cta hero__cta--text" aria-label="Conceptos clave">
          <span>Consciencia</span>
          <span>Y</span>
          <span>Libertad</span>
        </div>
      </div>
      <div class="hero__portrait">
        <img src="foto.jpeg" alt="Retrato conceptual de Juan Sebastian" />
      </div>
    </header>

    <main>
      <section class="newsletter" id="newsletter">
        <div class="newsletter__container">
          <p class="newsletter__subtitle">Pon tu email y recibirás de vez en cuando (cuando me salga de los huevos) reflexiones sobre los temas más importantes de tu vida</p>
          <form id="newsletterForm" class="newsletter__form">
            <input 
              type="email" 
              id="newsletterEmail" 
              name="email" 
              placeholder="Tu correo electrónico" 
              required
              class="newsletter__input"
            />
            <button type="submit" class="btn btn--newsletter" id="newsletterButton" disabled>Quiero recibir ;)</button>
          </form>
          <div id="newsletterMessage" class="newsletter__message"></div>
        </div>
      </section>

      <section class="feature feature--book" id="libro">
        <figure class="feature__image">
          <img src="libro.jpg" alt="Portada de Grácil vida" />
        </figure>
        <div class="feature__content">
          <p style="color: var(--muted); text-transform: uppercase; letter-spacing: 0.2em; font-size: clamp(1.2rem, 3vw, 2rem); margin-bottom: 1rem; font-family: var(--font-sans);">1. Consciencia</p>
          <p>Aquí resumo mi filosofía sobre el pensamiento, la conscienica y la vida. Directo, MUY CORTO y sin rodeos</p>
          <a
            class="btn btn--amazon"
            href="https://www.amazon.es/Grácil-vida-Breves-textos-cuestiones/dp/B0DBGKMRLQ"
            target="_blank"
            rel="noreferrer"
          >
            Ver en Amazon
          </a>
        </div>
      </section>

      <section class="feature feature--book feature--coming-soon" id="libertad">
        <figure class="feature__image feature__image--loading">
          <div class="book-loading">
            <div class="book-loading__spinner"></div>
            <div class="book-loading__text">Escribiendo...</div>
          </div>
        </figure>
        <div class="feature__content">
          <p style="color: var(--muted); text-transform: uppercase; letter-spacing: 0.2em; font-size: clamp(1.2rem, 3vw, 2rem); margin-bottom: 1rem; font-family: var(--font-sans);">2. Libertad</p>
          <p>Próximamente disponible. Reflexiones sobre la libertad y cómo conquistarla.</p>
          <button class="btn btn--amazon btn--coming-soon" disabled>
            Pronto en Amazon
          </button>
        </div>
      </section>

    </main>
  </body>
  <script>
    const title = document.querySelector("[data-type-title]");
    if (title) {
      const html = title.innerHTML;
      title.innerHTML = "";
      const parts = html.split("<br>");
      
      parts.forEach((part, partIdx) => {
        if (partIdx > 0) {
          const br = document.createElement("br");
          title.appendChild(br);
        }
        [...part].forEach((char, idx) => {
          const span = document.createElement("span");
          span.textContent = char === " " ? "\u00A0" : char;
          const totalIdx = parts.slice(0, partIdx).join("").length + idx;
          span.style.setProperty("--char-delay", `${totalIdx * 45}ms`);
          span.classList.add("char");
          title.appendChild(span);
        });
      });
    }

    const menuToggle = document.querySelector(".menu-toggle");
    const navMenu = document.querySelector(".site-nav__menu");
    
    if (menuToggle && navMenu) {
      menuToggle.addEventListener("click", () => {
        const isOpen = menuToggle.getAttribute("aria-expanded") === "true";
        menuToggle.setAttribute("aria-expanded", !isOpen);
        menuToggle.classList.toggle("menu-toggle--open");
        navMenu.classList.toggle("site-nav__menu--open");
        document.body.classList.toggle("menu-open");
      });

      navMenu.addEventListener("click", (e) => {
        if (e.target.tagName === "A") {
          menuToggle.setAttribute("aria-expanded", "false");
          menuToggle.classList.remove("menu-toggle--open");
          navMenu.classList.remove("site-nav__menu--open");
          document.body.classList.remove("menu-open");
        }
      });

      document.addEventListener("click", (e) => {
        if (navMenu.classList.contains("site-nav__menu--open") && 
            !navMenu.contains(e.target) && 
            !menuToggle.contains(e.target)) {
          menuToggle.setAttribute("aria-expanded", "false");
          menuToggle.classList.remove("menu-toggle--open");
          navMenu.classList.remove("site-nav__menu--open");
          document.body.classList.remove("menu-open");
        }
      });
    }

    // Configuración de la API
    // Si hay una variable de entorno configurada, úsala, sino detecta automáticamente
    const API_BASE_URL = window.API_BASE_URL || (
      window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://localhost:8080'
        : 'https://jsdejuansebastian-admin-production.up.railway.app'
    );
    const API_HISTORIAL_URL = `${API_BASE_URL}/api/reflexiones`;

    // Función para formatear fecha
    function formatearFecha(fechaString) {
      if (!fechaString) return '';
      const meses = ["ene", "feb", "mar", "abr", "may", "jun", "jul", "ago", "sep", "oct", "nov", "dic"];
      const fecha = new Date(fechaString + 'T00:00:00');
      const dia = fecha.getDate();
      const mes = meses[fecha.getMonth()];
      return `${dia} ${mes}`;
    }

    // Cargar todas las reflexiones del historial
    async function cargarReflexiones() {
      try {
        console.log('Intentando cargar reflexiones desde:', API_HISTORIAL_URL);
        const response = await fetch(API_HISTORIAL_URL);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const reflexiones = await response.json();
        console.log('Reflexiones recibidas:', reflexiones);
        
        const quotesList = document.getElementById('quotesList');
        if (!quotesList) {
          console.error('No se encontró el elemento quotesList');
          return;
        }
        
        // Limpiar la lista
        quotesList.innerHTML = '';
        
        // Crear elementos para cada reflexión
        reflexiones.forEach(reflexion => {
          if (!reflexion.titulo || !reflexion.parrafo) return;
          
          const item = document.createElement('div');
          item.className = 'quotes__item';
          
          const fecha = document.createElement('span');
          fecha.className = 'quotes__date';
          fecha.textContent = formatearFecha(reflexion.fecha);
          
          const titulo = document.createElement('p');
          titulo.className = 'quotes__line';
          titulo.textContent = reflexion.titulo;
          
          const texto = document.createElement('div');
          texto.className = 'quotes__text';
          const parrafo = document.createElement('p');
          parrafo.textContent = reflexion.parrafo;
          texto.appendChild(parrafo);
          
          item.appendChild(fecha);
          item.appendChild(titulo);
          item.appendChild(texto);
          
          quotesList.appendChild(item);
        });
        
        console.log(`Reflexiones cargadas exitosamente: ${reflexiones.length}`);
      } catch (error) {
        console.error('Error al cargar las reflexiones:', error);
        console.error('Detalles del error:', error.message);
      }
    }

    // Newsletter
    const newsletterForm = document.getElementById('newsletterForm');
    const newsletterMessage = document.getElementById('newsletterMessage');
    const newsletterEmail = document.getElementById('newsletterEmail');
    const newsletterButton = document.getElementById('newsletterButton');
    
    // Función para validar email y mostrar/ocultar botón
    function validarEmail() {
      const email = newsletterEmail.value.trim();
      const emailRegex = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i;
      const esValido = email && emailRegex.test(email);
      const hayTexto = email.length > 0;
      
      if (newsletterButton) {
        // Mostrar botón si hay texto, ocultarlo si está vacío
        if (hayTexto) {
          newsletterButton.style.display = 'block';
          newsletterButton.style.setProperty('display', 'block', 'important');
          // Habilitar solo si es válido
          newsletterButton.disabled = !esValido;
        } else {
          newsletterButton.style.display = 'none';
          newsletterButton.style.setProperty('display', 'none', 'important');
          newsletterButton.disabled = true;
        }
      }
    }
    
    // Asegurar que el botón esté oculto al cargar la página
    if (newsletterButton) {
      newsletterButton.style.display = 'none';
      newsletterButton.style.setProperty('display', 'none', 'important');
    }
    
    // Validar en tiempo real mientras el usuario escribe
    if (newsletterEmail) {
      newsletterEmail.addEventListener('input', validarEmail);
      newsletterEmail.addEventListener('blur', validarEmail);
    }
    
    if (newsletterForm) {
      newsletterForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = newsletterEmail.value.trim();
        
        if (!email) {
          return;
        }
        
        // Validar formato de email
        const emailRegex = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i;
        if (!emailRegex.test(email)) {
          newsletterMessage.className = 'newsletter__message error';
          newsletterMessage.textContent = 'Por favor, introduce un correo electrónico válido';
          
          setTimeout(() => {
            newsletterMessage.className = 'newsletter__message';
          }, 5000);
          return;
        }
        
        try {
          const response = await fetch(`${API_BASE_URL}/api/newsletter/subscribe`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            newsletterMessage.className = 'newsletter__message success';
            newsletterMessage.textContent = 'Perfecto!';
            newsletterForm.reset();
            
            // Ocultar botón después de enviar
            if (newsletterButton) {
              newsletterButton.disabled = true;
              newsletterButton.style.display = 'none';
            }
            
            setTimeout(() => {
              newsletterMessage.className = 'newsletter__message';
            }, 5000);
          } else {
            newsletterMessage.className = 'newsletter__message error';
            newsletterMessage.textContent = data.error || 'Error al suscribirse';
            
            setTimeout(() => {
              newsletterMessage.className = 'newsletter__message';
            }, 5000);
          }
        } catch (error) {
          newsletterMessage.className = 'newsletter__message error';
          newsletterMessage.textContent = 'Error de conexión. Intenta de nuevo.';
          
          setTimeout(() => {
            newsletterMessage.className = 'newsletter__message';
          }, 5000);
        }
      });
    }
  </script>
</html>



